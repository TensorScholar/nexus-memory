# NEXUS Reproducibility Guide

This document provides a comprehensive mapping between claims in the paper and the commands to reproduce them.

> **Forensic Validation:** For a single-step verification of all core claims (Safety, Zero-Copy, Scaling), see the [Validation Report](VALIDATION_REPORT.md), generated by `scripts/generate_validation_report.py`.


## Prerequisites

Before running any benchmarks, validate your environment:

```bash
./scripts/check_env.sh
```

### Required Setup

1. **Rust Toolchain** (1.75+):
   ```bash
   curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
   rustup default stable
   ```

2. **Python Dependencies** (for data generation):
   ```bash
   pip install pandas numpy
   ```

3. **RAPL Access** (Linux, for energy measurements):
   ```bash
   sudo chmod +r /sys/class/powercap/intel-rapl/intel-rapl:0/energy_uj
   # Or run with sudo: sudo -E cargo bench --features rapl
   ```

4. **Generate Financial Dataset** (1GB):
   ```bash
   python scripts/generate_financial_data.py --size 1024 --seed 42
   ```

---

## Paper Claims to Reproduction Commands

### Table 2: Throughput Comparison vs Baselines

| Claim | Description | Command |
|-------|-------------|---------|
| 2.1× vs Crossbeam | NEXUS throughput improvement over Crossbeam-epoch | `./scripts/run-benchmarks.sh baselines` |
| 1.8× vs Hazard Pointers | NEXUS throughput improvement over HP baseline | `./scripts/run-benchmarks.sh baselines` |
| 2.4× vs RCU | NEXUS throughput improvement over RCU baseline | `./scripts/run-benchmarks.sh baselines` |

**Full baseline comparison:**
```bash
cargo bench --package nexus-benchmarks -- baseline
```

*Note: Baseline results reflect the hardened `TraditionalProcessor` implementation using lazy evaluation (operator fusion) to ensure scientifically rigorous comparison against production-grade optimizations (e.g., Spark Catalyst, Flink pipelining).*

### Table 3: Cross-Paradigm Transition Overhead

| Claim | Description | Command |
|-------|-------------|---------|
| O(log n) overhead | Paradigm transition cost scales logarithmically | `cargo bench --package nexus-benchmarks -- paradigm_transitions` |
| Zero-copy transforms | O(1) memory overhead for transformations | `cargo bench --package nexus-benchmarks -- transition_overhead` |
| 15× vs Traditional | Unified execution speedup | `cargo bench --package nexus-benchmarks -- unified_pipeline` |

*Note: The baseline `TraditionalProcessor` implementation uses Rust iterators with lazy evaluation (operator fusion) to represent an optimized traditional multi-system architecture (e.g., Spark with Catalyst optimizer, Flink with pipelining). This ensures scientific fairness in the comparison.*

### Table 4: Energy Efficiency

| Claim | Description | Command |
|-------|-------------|---------|
| 2.3× efficiency | Energy efficiency vs flat epoch | `cargo bench --package nexus-benchmarks --features rapl -- energy_efficiency` |
| Linear scaling | Energy scales linearly with workload | `cargo bench --package nexus-benchmarks --features rapl -- energy_scaling` |

**Note:** Energy benchmarks require Linux with Intel RAPL support. On other platforms, simulated measurements are used (see warning messages).

### Table 5: Epoch Latency Distribution

| Claim | Description | Command |
|-------|-------------|---------|
| P50 latency | 50th percentile epoch operation latency | `cargo bench --package nexus-memory -- epoch` |
| P99 latency | 99th percentile tail latency | `cargo bench --package nexus-memory -- epoch` |
| Latency variance | Standard deviation of epoch operations | `cargo bench --package nexus-memory -- epoch` |

**Export results to CSV:**
```bash
cargo bench --package nexus-memory -- --save-baseline nexus-v1
```

### Table 6: NUMA Optimization

| Claim | Description | Command |
|-------|-------------|---------|
| 22% reduction | NUMA-aware allocation improvement | `./scripts/run-benchmarks.sh numa` |
| Local affinity | Cross-NUMA access reduction | `cargo bench --package nexus-memory -- numa` |

**Note:** NUMA benchmarks require a multi-socket system. Results on single-socket systems will show minimal difference.

### Figure 5: Batch Processing Scalability

| Claim | Description | Command |
|-------|-------------|---------|
| Linear scaling | Throughput scales with dataset size | `cargo bench --package nexus-benchmarks -- batch` |
| Batch efficiency | Processing efficiency metrics | `cargo bench --package nexus-benchmarks -- batch_benchmarks` |

### Figure 6: Stream Processing Performance

| Claim | Description | Command |
|-------|-------------|---------|
| Window efficiency | Sliding window operation cost | `cargo bench --package nexus-benchmarks -- stream` |
| Backpressure handling | Stream backpressure metrics | `cargo bench --package nexus-benchmarks -- stream_benchmarks` |

### Figure 7: Graph Processing Performance

| Claim | Description | Command |
|-------|-------------|---------|
| Graph traversal | BFS/DFS traversal performance | `cargo bench --package nexus-benchmarks -- graph` |
| Edge iteration | Edge processing throughput | `cargo bench --package nexus-benchmarks -- graph_benchmarks` |

---

## Formal Verification

### TLA+ Model Checking Results

The TLA+ specifications in `nexus-verification/spec/` have been verified using TLC:

| Specification | Invariants | States Explored | Command |
|--------------|------------|-----------------|---------|
| `epoch_reclamation.tla` | TypeInvariant, SafetyInvariant, NoUseAfterFree, NoDoubleFree | 12,473,690 | See below |
| `paradigm_transition.tla` | TypeInvariant, NoDeadlock, MemoryConsistency | 5,284,193 | See below |

**To verify TLA+ specifications:**
```bash
# Install TLA+ toolbox or use command-line TLC
java -jar tla2tools.jar -config formal-verification/model-config.cfg \
     nexus-verification/spec/epoch_reclamation.tla
```

### Rust Property Verification

```bash
cargo test --package nexus-verification
```

---

## Complete Reproduction Pipeline

To reproduce all results from the paper:

```bash
# 1. Check environment
./scripts/check_env.sh

# 2. Generate test data
python scripts/generate_financial_data.py --size 1024 --seed 42

# 3. Run all benchmarks
./scripts/reproduce-all.sh

# 4. Generate figures
python scripts/generate-figures.py
```

**Estimated runtime:** 2-4 hours depending on hardware.

---

## Output Locations

| Output Type | Location |
|-------------|----------|
| Benchmark results (JSON) | `target/criterion/` |
| Statistical summary | `nexus-benchmarks/results/statistical-summary.json` |
| Epoch latency data | `nexus-benchmarks/results/epoch-latency.csv` |
| Generated figures | `figures/` |

---

## Troubleshooting

### RAPL Permission Denied
```bash
# Option 1: Add read permission
sudo chmod +r /sys/class/powercap/intel-rapl/intel-rapl:0/energy_uj

# Option 2: Run with sudo
sudo -E cargo bench --features rapl

# Option 3: Use simulated energy (less accurate)
cargo bench  # Will use SimulatedMonitor automatically
```

### Benchmark Variance Too High
```bash
# Disable CPU frequency scaling
sudo cpupower frequency-set -g performance

# Pin to specific cores
taskset -c 0-3 cargo bench
```

### Missing Financial Data
```bash
# Generate the dataset
python scripts/generate_financial_data.py --size 1024

# Verify file exists
ls -la nexus-benchmarks/data/financial_transactions.csv
```

---

## Hardware Used in Paper

The results in the paper were obtained on:

- **CPU:** Intel Xeon Gold 6248R (2× 24 cores, 48 threads each)
- **Memory:** 384 GB DDR4-2933 (12× 32GB, 6 per socket)
- **NUMA:** 2 NUMA nodes
- **OS:** Ubuntu 22.04 LTS, Kernel 5.15
- **Rust:** 1.75.0

Results on different hardware may vary. Please report your hardware configuration when comparing results.

---

## Citation

If you use this artifact, please cite:

```bibtex
@article{nexus2026,
  title={NEXUS: A Unified Memory Reclamation Framework for Cross-Paradigm Data Processing},
  author={...},
  journal={Proceedings of the VLDB Endowment},
  volume={19},
  year={2026}
}
```
